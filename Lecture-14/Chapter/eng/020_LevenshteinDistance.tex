\section{Edit distance}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Definition of edit distance}: (\textit{Levenshtein-distance})
  \begin{itemize}
    \item
      Let {\color{Mittel-Blau}$x$}, {\color{Mittel-Blau}$y$} be two strings
    \item
      Edit distance {\color{Mittel-Blau}$\mathrm{ED}(x, y)$} of
      {\color{Mittel-Blau}$x$} and {\color{Mittel-Blau}$y$}:\\
      The minimal number of operations to transform {\color{Mittel-Blau}$x$}
      into {\color{Mittel-Blau}$y$}
      \begin{itemize}
        \item
          \texttt{Insert} a character
        \item
          \texttt{Replace} a character with another
        \item
          \texttt{Delete} a character
          % Die Position einer Operation ist ... siehe Beispiel ???
      \end{itemize}
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}{Example}
  \begin{columns}
    \begin{column}{0.5\linewidth}
      \begin{center}
        \begin{tabular}{c@{}c@{}c@{}c@{}cl}
          1 & 2 & 3 & 4 & 5\\
          D & O & O & F\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{replace(1, B)}\\
          B & O & O & F\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{replace(2, L)}\\
          B & L & O & F\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{insert(4, E)}\\
          B & L & O & E & F\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{replace(5, D)}\\
          B & L & O & E & D\\
          {} & {} & {} & {} & {} &
          $\underbrace{\hspace{7.5em}}_{\mathrm{ED} = 4}$
        \end{tabular}
      \end{center}
    \end{column}
    \begin{column}{0.5\linewidth}
      \begin{center}
        \begin{tabular}{c@{}c@{}c@{}c@{}cl}
          1 & 2 & 3 & 4 & 5\\
          B & L & O & E & D\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{replace(5, F)}\\
          B & L & O & E & F\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{delete(4)}\\
          B & L & O & F\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{replace(2, O)}\\
          B & O & O & F\\
          {} & {} & $\downarrow$ & {} & {} & \texttt{replace(1, D)}\\
          D & O & O & F\\
          {} & {} & {} & {} & {} &
          $\underbrace{\hspace{7.5em}}_{\mathrm{ED} = 4}$
        \end{tabular}
      \end{center}
    \end{column}
  \end{columns}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Notation:}
  \begin{itemize}
    \item
      $\varepsilon$ is the empty string
    \item
      $\vert x \vert$ is the length of the string $x$ (number of characters)
    \item
      $x[i..j]$ is the slice of $x$ from $i$ to $j$ where
      $1 \leq i \leq j \leq \vert x \vert$
  \end{itemize}
  \begin{figure}[!h]
    \begin{adjustbox}{width=0.75\linewidth}
      \input{Images/Levenshtein_Distance/Slice.tikz}
    \end{adjustbox}
  \end{figure}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Trivial facts:}
  \begin{itemize}
    \item
      $\mathrm{ED}(x, y) = \mathrm{ED}(y, x)$
    \item
      $\mathrm{ED}(x, \epsilon) = \vert x \vert$
    \item
      $\mathrm{ED}(x, y) \geq \mathrm{abs}(\vert x \vert - \vert y \vert)$
      \hfill
      $\mathrm{abs}(x) = \begin{cases}
        x & \text{if } x \geq 0\\
        -x & \text{else}
      \end{cases}$
    \item
      $\mathrm{ED}(x, y) \leq \mathrm{ED}(x[1..n-1], y[1..m-1]) + 1$
      \hfill
      $n = \vert x \vert, \; m = \vert y \vert$
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}{Solving examples}
  \textbf{Solutions based on examples:}
  \begin{itemize}
    \item
      From \texttt{VERIEN} to \texttt{FERIEN}?
    \item
      From \texttt{MEXIKO} to \texttt{AMERIKA}?
    \item
      From \texttt{AAEBEAABEAREEAEBA} to \texttt{RBEAAEEBAAAEBBAEAE}?
    \item
      Searching biggest substrings can yield the solution but doesn't have to
  \end{itemize}
  \vspace{1.0em}
  \textbf{Recursive approach:}
  \begin{itemize}
    \item
      Dividing in two halves? Not a good idea:\\[0.5em]
      {\color{Mittel-Blau}$\mathrm{ED}(GRAU, RAUM) = 2$} \; but \;
      {\color{Mittel-Blau}$\mathrm{ED}(GR, RA) + \mathrm{ED}(AU, UM) = 4$}
      \\[0.5em]
    \item
      Finding \enquote{smaller} sub problems?\\
      {\color{gray}Let's try it!}
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Terminology:}
  \begin{itemize}
    \item
      Let {\color{Mittel-Blau}$x$}, {\color{Mittel-Blau}$y$} be two strings
    \item
      Let $\sigma_1, \dots, \sigma_k$ be a sequence of $k$ operations
      where $k = \mathrm{ED}(x, y)$ for {\color{Mittel-Blau}$x \rightarrow y$}
      (transform {\color{Mittel-Blau}$x$} into {\color{Mittel-Blau}$y$})\\
      {\color{gray}(We do not know this sequence but we assume it exists)}
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Terminology:}
  \begin{itemize}
    \item
      We only regard {\color{Mittel-Blau}monotonous} sequences:\\
      The positition of $\sigma_{i+1}$ is $\geq$ the position of $\sigma_i$
      where we only allow the positions to be equal on a \texttt{delete}
      operation
  \end{itemize}
  \begin{columns}
    \begin{column}{0.5\linewidth}
      \begin{center}
        \begin{tabular}{c@{}c@{}c@{}c@{}cl}
          1 & 2 & 3 & 4 & 5\\
          D & O & O & F\\
          {} & {} & $\downarrow$ & {} & {} &
          \texttt{replace({\color{Mittel-Blau}1}, B)}\\
          B & O & O & F\\
          {} & {} & $\downarrow$ & {} & {} &
          \texttt{replace({\color{Mittel-Blau}2}, L)}\\
          B & L & O & F\\
          {} & {} & $\downarrow$ & {} & {} &
          \texttt{insert({\color{Mittel-Blau}4}, E)}\\
          B & L & O & E & F\\
          {} & {} & $\downarrow$ & {} & {} &
          \texttt{replace({\color{Mittel-Blau}5}, D)}\\
          B & L & O & E & D
        \end{tabular}
      \end{center}
    \end{column}
    \begin{column}{0.5\linewidth}
      \begin{center}
        \begin{tabular}{c@{}c@{}c@{}c@{}c@{}c@{}cl}
          1 & 2 & 3 & 4 & 5 & 6 & 7\\
          S & A & U & D & O & O & F\\
          {} & {} & {} & $\downarrow$ & {} & {} & {} &
          \texttt{delete({\color{Mittel-Blau}1})}\\
          A & U & D & O & O & F\\
          {} & {} & {} & $\downarrow$ & {} & {} & {} &
          \texttt{delete({\color{Mittel-Blau}1})}\\
          U & D & O & O & F\\
          {} & {} & {} & $\downarrow$ & {} & {} & {} &
          \texttt{delete({\color{Mittel-Blau}1})}\\
          D & O & O & F\\
          {} & {} & {} & $\downarrow$ & {} & {} & {} &
          \texttt{insert({\color{Mittel-Blau}4}, O)}\\
          D & O & O & O & F
        \end{tabular}
      \end{center}
    \end{column}
  \end{columns}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Terminology:}
  \begin{itemize}
    \item
      \textbf{Lemma:}
      For any {\color{Mittel-Blau}$x$} and {\color{Mittel-Blau}$y$}
      with $k = \mathrm{ED}(x, y)$ exists a {\color{Mittel-Blau}monotonous}
      sequence of $k$ operations for {\color{Mittel-Blau}$x \rightarrow y$}
    \item
      \textbf{Intuition:}
      The order of our sequence is not relevant\\
      (We can sort them monotonous as desired)
  \end{itemize}
  \begin{columns}[T]
    \begin{column}{0.5\linewidth}
      \begin{center}
        \begin{tabular}{ccccc}
          1 & 2 & 3 & 4 & 5\\
          D & O & O & F\\
          \\
          B & L & O & E & D
        \end{tabular}
      \end{center}
    \end{column}
    \begin{column}{0.5\linewidth}
      \begin{center}
        \begin{tabular}{ccccccc}
          1 & 2 & 3 & 4 & 5 & 6 & 7\\
          S & A & U & D & O & O & F\\
          \\
          D & O & O & O & F
        \end{tabular}
      \end{center}
    \end{column}
  \end{columns}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}{Recursive approach}
  \textbf{Regard last operation:}
  \begin{itemize}
    \item
      Solve {\color{Mittel-Blau}blue} part recursively
  \end{itemize}
  \begin{columns}[T]
    \begin{column}{0.3\linewidth}
      \begin{figure}[!h]
        \begin{center}
          \begin{tabular}{c@{}c@{}c@{}c@{}c@{}l}
            \color{Mittel-Blau}D & \color{Mittel-Blau}O & \color{Mittel-Blau}O &
            \color{Mittel-Blau}F\\
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$ &
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$\\
            \color{Mittel-Blau}B & \color{Mittel-Blau}L & \color{Mittel-Blau}O &
            \color{Mittel-Blau}E\\
            {} & {} & {} & {} & $\downarrow$ & \texttt{insert}\\
            B & L & O & E & D
          \end{tabular}
        \end{center}
        \caption{Case 1a}
      \end{figure}
    \end{column}
    \begin{column}{0.3\linewidth}
      \begin{figure}[!h]
        \begin{center}
          \begin{tabular}{c@{}c@{}c@{}c@{}c@{}c@{}l}
            {} & {} & \color{Mittel-Blau}D & \color{Mittel-Blau}O &
            \color{Mittel-Blau}O & \color{Mittel-Blau}F\\
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$ &
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$ &
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$\\
            \color{Mittel-Blau}B & \color{Mittel-Blau}L & \color{Mittel-Blau}O &
            \color{Mittel-Blau}E & \color{Mittel-Blau}D & \color{Mittel-Blau}F\\
            {} & {} & {} & {} & {} & $\downarrow$ & \texttt{delete}\\
            B & L & O & E & D
          \end{tabular}
        \end{center}
        \caption{Case 1b}
      \end{figure}
    \end{column}
    \begin{column}{0.3\linewidth}
      \begin{figure}[!h]
        \begin{center}
          \begin{tabular}{c@{}c@{}c@{}c@{}c@{}l}
            {} & \color{Mittel-Blau}D & \color{Mittel-Blau}O &
            \color{Mittel-Blau}O & \color{Mittel-Blau}F\\
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$ &
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$ &
            \color{Mittel-Blau}$\downarrow$\\
            \color{Mittel-Blau}B & \color{Mittel-Blau}L & \color{Mittel-Blau}O &
            \color{Mittel-Blau}E & \color{Mittel-Blau}F\\
            {} & {} & {} & {} & $\downarrow$ & \texttt{replace}\\
            B & L & O & E & D
          \end{tabular}
        \end{center}
        \caption{Case 1c}
      \end{figure}
    \end{column}
  \end{columns}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}{Recursive approach}
  \textbf{Regard last operation:}
  \begin{itemize}
    \item
      Solve {\color{Mittel-Blau}blue} part recursively
  \end{itemize}
  \begin{columns}
    \begin{column}{0.3\linewidth}
      \begin{figure}[!h]
        \begin{center}
          \begin{tabular}{c@{}c@{}c@{}c@{}c@{}c@{}c@{}l}
            \color{Mittel-Blau}W & \color{Mittel-Blau}I & \color{Mittel-Blau}N &
            \color{Mittel-Blau}T & \color{Mittel-Blau}E & \color{Mittel-Blau}R\\
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$ &
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$ &
            \color{Mittel-Blau}$\downarrow$ & \color{Mittel-Blau}$\downarrow$\\
            \color{Mittel-Blau}S & \color{Mittel-Blau}O & \color{Mittel-Blau}M &
            \color{Mittel-Blau}M & \color{Mittel-Blau}E & \color{Mittel-Blau}R\\
            {} & {} & {} & {} & {} & $\downarrow$ & \texttt{nothing}\\
            S & O & M & M & E & R
          \end{tabular}
        \end{center}
        \caption{Case 2}
      \end{figure}
    \end{column}
    \begin{column}{0.5\linewidth}
      \textbf{Display of solution:}
      \begin{itemize}
        \item
          Alignment
        \item
          Example:
          \begin{tabular}{cccccccc}
            \_ & \_ & \_ & B & L & O & E & D\\
            S & A & U & B & L & O & E & D
          \end{tabular}
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}{Dynamic programming}
  \begin{columns}
    \begin{column}{0.65\linewidth}
      \textbf{Dynamic programming:}
      \begin{itemize}
        \item
          Instances of Bellman's principle of optimality:
        \begin{itemize}
          \item
            Shortest paths
          \item
            Edit distance
          \end{itemize}
      \end{itemize}
    \end{column}
    \begin{column}{0.35\linewidth}
      \begin{figure}[!h]
        \includegraphics[width=0.9\linewidth, clip, trim=10 0 10 0]%
          {Images/Levenshtein_Distance/Richard_Ernest_Bellman.jpg}
        \caption{Richard Bellman (1920 - 1984)}
      \end{figure}
    \end{column}
  \end{columns}
  \begin{itemize}
    \item
      Optimal solutions consist of optimal partial solutions
      \begin{itemize}
        \item
          Shortest paths: Each partial path has to be optimal
        \item
          Edit distance: Each partial alignment has to be optimal\\
          \begin{figure}[!h]
            \only<1|handout:0>{
              \begin{tabular}{cccccccccc}
                \_ & \_ & \_ & B & L & O & E & D & E & R\\
                S & A & U & B & L & O & E & D & \_ & \_
              \end{tabular}
            }%
            \only<2>{%
              \begin{tabular}{cccc|cccccc}
                \_ & \_ & \_ & B & L & O & E & D & E & R\\
                S & A & U & B & L & O & E & D & \_ & \_
              \end{tabular}
            }%
          \end{figure}
      \end{itemize}
    \item
      Always solvable through dynamic programming\\
      (Caching of optimal partial solutions)
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Case analysis:}
  \begin{itemize}
    \item
      We regard the last operation $\sigma_k$
      \begin{itemize}
        \item
          $\sigma_1, \dots, \sigma_{k-1}$:
          {\color{Mittel-Blau}$x \rightarrow z$} and $\sigma_k$:
          {\color{Mittel-Blau}$z \rightarrow y$}\\
          Example:
          \begin{displaymath}
            x = \mathrm{DOOF}, \;
            z = \mathrm{SAUBLOEF}, \;
            y = \mathrm{SAUBLOED}
          \end{displaymath}
        \item
          Let $n = \vert x \vert, \; m = \vert y \vert, \; m' = \vert z \vert$
        \item
          We note $m' \in \{m - 1, m, m + 1\}$
          \hspace{1.5em}
          {\color{gray}why?}
      \end{itemize}
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Case analysis:}
  \begin{itemize}
    \item
      Case 1: {\color{Mittel-Blau}$\sigma_k$} does something at the outer end:
      \begin{itemize}
        \item
          Case 1a:
          {\color{Mittel-Blau}$\sigma_k = \texttt{insert}(m' + 1, y[m])$}
          \hfill
          [then {\color{Mittel-Blau}$m' = m - 1$}]
        \item
          Case 1b:
          {\color{Mittel-Blau}$\sigma_k = \texttt{delete}(m')$}
          \hfill
          [then {\color{Mittel-Blau}$m' = m + 1$}]
        \item
          Case 1c:
          {\color{Mittel-Blau}$\sigma_k = \texttt{replace}(m', y[m])$}
          \hfill
          [then {\color{Mittel-Blau}$m' = m$}]
      \end{itemize}
      \vspace{0.5em}
    \item
      Case 2: {\color{Mittel-Blau}$\sigma_k$} does nothing at the outer end:
      \begin{itemize}
        \item
          Then {\color{Mittel-Blau}$z[m'] = y[m]$} and
          {\color{Mittel-Blau}$x[n'] = z[m']$} and with that\\
          $\sigma_1, \dots, \sigma_{k-1}$:
          {\color{Mittel-Blau}$x[1..n-1] \rightarrow y[1..m-1]$} and
          {\color{Mittel-Blau}$x[n] = y[m]$}
      \end{itemize}
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
  \textbf{Case analysis:}
  \begin{itemize}
    \item
      Case 1a (\texttt{insert}):
      \hfill
      {\color{Mittel-Blau}$\sigma_1, \dots, \sigma_{k-1}$}:
      {\color{Mittel-Blau}$x\hphantom{[1..n-1]} \rightarrow y[1..m-1]$}
    \item
      Case 1b (\texttt{delete}):
      \hfill
      {\color{Mittel-Blau}$\sigma_1, \dots, \sigma_{k-1}$}:
      {\color{Mittel-Blau}$x[1..n-1] \rightarrow y\hphantom{[1..m-1]}$}
    \item
      Case 1c (\texttt{replace}):
      \hfill
      {\color{Mittel-Blau}$\sigma_1, \dots, \sigma_{k-1}$}:
      {\color{Mittel-Blau}$x[1..n-1] \rightarrow y[1..m-1]$}
    \item
      Case 2 (\texttt{nothing}):
      \hfill
      {\color{Mittel-Blau}$\sigma_1, \dots, \sigma_{k}$}:
      {\color{Mittel-Blau}$x[1..n-1] \rightarrow y[1..m-1]$}
  \end{itemize}
  \textbf{This results in the recursive formula:}
  \begin{itemize}
    \item
      For {\color{Mittel-Blau}$\vert x \vert > 0$} and
      {\color{Mittel-Blau}$\vert y \vert > 0$} is
      {\color{Mittel-Blau}$\mathrm{ED}(x, y)$} the minimum of
      \begin{itemize}
        \item
          {\color{Mittel-Blau}
            $\mathrm{ED}(x\hphantom{[1..n-1]}, y[1..m-1]) + 1$} and
        \item
          {\color{Mittel-Blau}
            $\mathrm{ED}(x[1..n-1], y\hphantom{[1..m-1]}) + 1$} and
        \item
          {\color{Mittel-Blau}
            $\mathrm{ED}(x[1..n-1], y[1..m-1]) + 1$} if
          {\color{Mittel-Blau}$x[n] \neq y[m]$}
        \item
          {\color{Mittel-Blau}
            $\mathrm{ED}(x[1..n-1], y[1..m-1]) + 0$} if
          {\color{Mittel-Blau}$x[n] = y[m]$}
      \end{itemize}
    \item
      For {\color{Mittel-Blau}$\vert x \vert = 0$} is
      {\color{Mittel-Blau}$\mathrm{ED}(x, y) = \vert y \vert$}
    \item
      For {\color{Mittel-Blau}$\vert y \vert = 0$} is
      {\color{Mittel-Blau}$\mathrm{ED}(x, y) = \vert x \vert$}
  \end{itemize}
\end{frame}

%-------------------------------------------------------------------------------

\codeslide{python}{
\begin{frame}{Edit distance}{Python}
\end{frame}
}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
\end{frame}

%-------------------------------------------------------------------------------

\begin{frame}{Edit distance}
\end{frame}

%{%
%\setbeamertemplate{headline}[default]
%\makeatletter\def\beamer@entrycode{\vspace*{-\headheight}}\makeatother
%\begin{frame}{Levenshtein Distance}
%  \begin{center}
%    \begin{adjustbox}{width=0.8\linewidth}
%      \def\AlgoIntro{1}
%      \def\AlgoFinal{0}
%      \input{Images/Levenshtein_Distance/Grid.tikz}
%    \end{adjustbox}
%  \end{center}
%\end{frame}
%}%